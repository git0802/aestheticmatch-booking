generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String     @id @default(cuid())
  workosId     String     @unique @map("workos_id")
  email        String     @unique
  firstName    String     @map("first_name")
  lastName     String     @map("last_name")
  role         UserRole   @default(CONCIERGE)
  status       UserStatus @default(ACTIVE)
  emailVerified Boolean   @default(false) @map("email_verified")
  lastLogin    DateTime?  @map("last_login")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  // Relations
  createdPatients Patient[] @relation("PatientCreatedBy")
  updatedPatients Patient[] @relation("PatientUpdatedBy")

  @@map("users")
}

enum UserRole {
  CONCIERGE
  OPS_FINANCE
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
}

model Patient {
  id                        String    @id @default(uuid()) @db.Uuid
  name                      String    @db.VarChar(255)
  dob                       DateTime  @map("dob") @db.Date
  email                     String    @unique @db.VarChar(255)
  phone                     String?   @db.VarChar(25)
  notes                     String?   @db.Text
  amReferralId              String    @unique @map("am_referral_id") @db.Uuid
  consentFormsSigned        Boolean?  @default(false) @map("consent_forms_signed")
  privacyNoticeAcknowledged Boolean?  @default(false) @map("privacy_notice_acknowledged")
  createdBy                 String    @map("created_by")
  updatedBy                 String    @map("updated_by")
  createdAt                 DateTime  @default(now()) @map("created_at")
  updatedAt                 DateTime  @updatedAt @map("updated_at")

  // Relations
  createdByUser User @relation("PatientCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User @relation("PatientUpdatedBy", fields: [updatedBy], references: [id])
  pastSurgeries PatientPastSurgery[]

  @@map("patients")
}

model PatientPastSurgery {
  id          String    @id @default(uuid()) @db.Uuid
  patientId   String    @map("patient_id") @db.Uuid
  surgeryType String    @map("surgery_type") @db.VarChar(100)
  surgeryDate DateTime? @map("surgery_date") @db.Date
  details     String?   @db.Text
  createdAt   DateTime  @default(now()) @map("created_at")

  // Relations
  patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("patient_past_surgeries")
}
